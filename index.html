<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProCode Studio - Ø¨ÙŠØ¦Ø© ØªØ·ÙˆÙŠØ± Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    
    <!-- CodeMirror 6 - Ø¥ØµØ¯Ø§Ø± Ù…ØªÙ‚Ø¯Ù… -->
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/view@6.25.2/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/state@6.4.1/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/basic-setup@0.20.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-javascript@6.2.2/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-html@6.5.5/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-css@6.3.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-python@6.2.1/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-markdown@6.2.4/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-json@6.0.1/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-sql@6.6.1/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-xml@6.1.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-yaml@6.1.1/dist/index.min.js"></script>
    
    <!-- Ø®Ø·ÙˆØ· Ù…Ø­Ø³Ù†Ø© -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Lucide -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        :root {
            --primary-bg: #1e1e1e;
            --secondary-bg: #2d2d30;
            --tertiary-bg: #3e3e42;
            --accent-color: #007acc;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --text-primary: #cccccc;
            --text-secondary: #969696;
            --border-color: #464647;
            --editor-bg: #1e1e1e;
            --selection-color: #264f78;
            --line-number-color: #858585;
            --bracket-matching: #264f78;
            --active-line-bg: #2a2d2e;
        }

        /* ÙˆØ¶Ø¹ ÙØ§ØªØ­ */
        .light-theme {
            --primary-bg: #ffffff;
            --secondary-bg: #f8f9fa;
            --tertiary-bg: #e9ecef;
            --accent-color: #007acc;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --error-color: #dc3545;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --editor-bg: #ffffff;
            --selection-color: #b3d7ff;
            --line-number-color: #6c757d;
            --bracket-matching: #cce5ff;
            --active-line-bg: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: 
                linear-gradient(rgba(15, 20, 25, 0.85), rgba(15, 20, 25, 0.85)),
                url('user_input_files/24a4af051509d92474c2fecf8258e3e7.webp');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            font-size: 13px;
            line-height: 1.5;
        }

        /* ØªØ£Ø«ÙŠØ± Matrix Ù…Ø­Ø³Ù† */
        .matrix-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .matrix-column {
            position: absolute;
            top: -100%;
            width: 18px;
            height: 100%;
            overflow: hidden;
            opacity: 0.08;
        }

        .matrix-digit {
            position: absolute;
            color: #00ff41;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 500;
            text-shadow: 0 0 8px #00ff41;
            animation: fall 2.8s linear infinite;
        }

        @keyframes fall {
            0% {
                transform: translateY(-100%);
                opacity: 0;
            }
            8% {
                opacity: 1;
            }
            92% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        .app-container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            height: 100vh;
            backdrop-filter: blur(1px);
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
        .header {
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            padding: 8px 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .logo {
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-color), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-left: auto;
            font-family: 'JetBrains Mono', monospace;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-container {
            display: flex;
            gap: 8px;
            flex: 1;
            min-width: 300px;
            max-width: 500px;
        }

        .url-input, .search-input {
            flex: 1;
            padding: 8px 12px;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 400;
        }

        .url-input:focus, .search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.2);
            background: var(--primary-bg);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            position: relative;
            overflow: hidden;
            font-family: 'JetBrains Mono', monospace;
        }

        .btn:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }

        .btn:hover:before {
            width: 200px;
            height: 200px;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 122, 204, 0.25);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-content {
            flex: 1;
            display: flex;
            min-height: 0;
            position: relative;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar {
            width: 250px;
            background: var(--secondary-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .sidebar.collapsed {
            width: 0;
            min-width: 0;
        }

        .sidebar-tabs {
            display: flex;
            background: var(--primary-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-tab {
            flex: 1;
            padding: 8px 12px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .sidebar-tab.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }

        .sidebar-content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .file-tree, .search-results {
            font-size: 12px;
            font-family: 'JetBrains Mono', monospace;
        }

        .file-item, .search-item {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 2px;
            transition: background 0.2s ease;
        }

        .file-item:hover, .search-item:hover {
            background: var(--tertiary-bg);
        }

        /* Ù…Ø­Ø±Ø± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
        .editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--primary-bg);
            position: relative;
        }

        .editor-header {
            background: var(--secondary-bg);
            padding: 6px 12px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            min-height: 36px;
        }

        .editor-tabs {
            display: flex;
            gap: 2px;
            overflow-x: auto;
            flex: 1;
        }

        .editor-tab {
            padding: 6px 12px;
            background: var(--tertiary-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 400;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 80px;
            position: relative;
        }

        .editor-tab.active {
            background: var(--primary-bg);
            color: var(--text-primary);
            border-bottom-color: var(--primary-bg);
        }

        .editor-tab:hover {
            background: var(--accent-color);
            color: white;
        }

        .tab-close {
            margin-left: 6px;
            opacity: 0.7;
            font-size: 10px;
        }

        .tab-close:hover {
            opacity: 1;
        }

        .editor-actions {
            display: flex;
            gap: 6px;
        }

        .editor-wrapper {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        /* CodeMirror Styling */
        .cm-editor {
            height: 100% !important;
            font-family: 'JetBrains Mono', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
            background: var(--editor-bg) !important;
        }

        .cm-focused {
            outline: none !important;
        }

        .cm-scroller {
            font-family: inherit !important;
        }

        .cm-gutters {
            background: var(--secondary-bg) !important;
            border-right: 1px solid var(--border-color) !important;
        }

        .cm-linenumber {
            color: var(--line-number-color) !important;
            padding: 0 8px !important;
            font-size: 11px !important;
        }

        .cm-activeLineGutter {
            background: var(--active-line-bg) !important;
        }

        .cm-activeLine {
            background: var(--active-line-bg) !important;
        }

        .cm-selectionBackground {
            background: var(--selection-color) !important;
        }

        .cm-matchingBracket {
            background: var(--bracket-matching) !important;
            color: white !important;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
        .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--primary-bg);
            border-left: 1px solid var(--border-color);
        }

        .preview-header {
            background: var(--secondary-bg);
            padding: 6px 12px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .preview-title {
            color: var(--accent-color);
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
        }

        .preview-frame {
            flex: 1;
            border: none;
            background: white;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
        .status-bar {
            background: var(--secondary-bg);
            padding: 6px 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .status-left, .status-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--secondary-bg);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            max-width: 350px;
            font-size: 12px;
            font-family: 'JetBrains Mono', monospace;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification.success {
            border-color: var(--success-color);
            background: rgba(76, 175, 80, 0.1);
        }

        .notification.error {
            border-color: var(--error-color);
            background: rgba(244, 67, 54, 0.1);
        }

        .notification.warning {
            border-color: var(--warning-color);
            background: rgba(255, 152, 0, 0.1);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø­Ø³Ù† */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(0, 122, 204, 0.1);
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .progress-container.show {
            opacity: 1;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), #1d4ed8);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Ù„ÙˆØ­Ø© Command Palette */
        .command-palette {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 500px;
            max-height: 400px;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .command-palette.show {
            opacity: 1;
            pointer-events: all;
        }

        .command-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--primary-bg);
            border: none;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            outline: none;
        }

        .command-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .command-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
            font-family: 'JetBrains Mono', monospace;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .command-item:hover, .command-item.active {
            background: var(--tertiary-bg);
        }

        .command-key {
            color: var(--text-secondary);
            font-size: 11px;
        }

        /* Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .settings-panel.show {
            opacity: 1;
            pointer-events: all;
        }

        .settings-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .settings-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-body {
            padding: 16px;
        }

        .setting-group {
            margin-bottom: 24px;
        }

        .setting-group h3 {
            color: var(--accent-color);
            margin-bottom: 12px;
            font-size: 14px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .setting-label {
            font-size: 13px;
        }

        .setting-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 1200px) {
            .sidebar {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            body {
                font-size: 12px;
            }
            
            .header {
                padding: 6px 12px;
                flex-direction: column;
                gap: 8px;
            }

            .search-container {
                min-width: 100%;
                max-width: none;
                flex-direction: column;
            }

            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 200px;
            }

            .command-palette {
                width: 90%;
                max-width: 400px;
            }

            .settings-content {
                width: 95%;
                max-width: 500px;
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .file-upload {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-upload input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .loading-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 1px solid rgba(0, 122, 204, 0.3);
            border-top: 2px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tooltip {
            position: absolute;
            background: var(--secondary-bg);
            color: var(--text-primary);
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            border: 1px solid var(--border-color);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        .tooltip.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- ØªØ£Ø«ÙŠØ± Matrix -->
    <div class="matrix-container" id="matrixContainer"></div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="app-container">
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
        <div class="header">
            <div class="search-container">
                <input type="url" class="url-input" id="urlInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ù„Ù…Ù„Ù...">
                <button class="btn btn-primary" onclick="fetchCode()">
                    <i class="fas fa-download"></i>
                    Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯
                </button>
                <input type="text" class="search-input" id="searchInput" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª... (Ctrl+Shift+F)">
            </div>
            
            <label class="btn btn-secondary file-upload">
                <i class="fas fa-upload"></i>
                Ø±ÙØ¹ Ù…Ù„Ù
                <input type="file" id="fileInput" multiple onchange="handleFileUpload(event)">
            </label>
            
            <button class="btn btn-secondary" onclick="toggleSidebar()" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ">
                <i class="fas fa-bars"></i>
            </button>
            
            <button class="btn btn-secondary" onclick="showCommandPalette()" title="Command Palette (Ctrl+Shift+P)">
                <i class="fas fa-terminal"></i>
            </button>
            
            <button class="btn btn-secondary" onclick="toggleTheme()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø© (Ctrl+Shift+L)">
                <i class="fas fa-palette"></i>
            </button>
            
            <button class="btn btn-secondary" onclick="showSettings()" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ctrl+,)">
                <i class="fas fa-cog"></i>
            </button>
            
            <div class="logo">
                <i class="fas fa-code"></i>
                ProCode Studio
            </div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="main-content">
            <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-tabs">
                    <button class="sidebar-tab active" onclick="switchSidebarTab('files')">
                        <i class="fas fa-folder"></i>
                        Ø§Ù„Ù…Ù„ÙØ§Øª
                    </button>
                    <button class="sidebar-tab" onclick="switchSidebarTab('search')">
                        <i class="fas fa-search"></i>
                        Ø§Ù„Ø¨Ø­Ø«
                    </button>
                </div>
                <div class="sidebar-content">
                    <div id="filesPanel" class="file-tree">
                        <div class="file-item">
                            <i class="fas fa-file-code"></i>
                            welcome.html
                        </div>
                        <div class="file-item">
                            <i class="fas fa-file-code"></i>
                            styles.css
                        </div>
                        <div class="file-item">
                            <i class="fas fa-file-code"></i>
                            script.js
                        </div>
                        <div class="file-item">
                            <i class="fas fa-file-alt"></i>
                            README.md
                        </div>
                    </div>
                    <div id="searchPanel" class="search-results" style="display: none;">
                        <div class="search-item">
                            <i class="fas fa-search"></i>
                            Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ù…Ø­Ø±Ø± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ -->
            <div class="editor-panel">
                <div class="editor-header">
                    <div class="editor-tabs" id="editorTabs">
                        <div class="editor-tab active" data-file="welcome.html">
                            <i class="fas fa-file-code"></i>
                            welcome.html
                            <span class="tab-close" onclick="closeTab(this)">Ã—</span>
                        </div>
                    </div>
                    <div class="editor-actions">
                        <button class="btn btn-secondary" onclick="saveFile()" title="Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù (Ctrl+S)">
                            <i class="fas fa-save"></i>
                        </button>
                        <button class="btn btn-secondary" onclick="formatCode()" title="ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯ (Shift+Alt+F)">
                            <i class="fas fa-magic"></i>
                        </button>
                        <button class="btn btn-success" onclick="runCode()" title="ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ (F5)">
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div id="editor"></div>
                </div>
            </div>

            <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
            <div class="preview-panel">
                <div class="preview-header">
                    <div class="preview-title">
                        <i class="fas fa-eye"></i>
                        Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
                    </div>
                    <button class="btn btn-secondary" onclick="refreshPreview()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Ctrl+R)">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <iframe class="preview-frame" id="previewFrame" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
            </div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div class="status-bar">
            <div class="status-left">
                <div class="status-item">
                    <i class="fas fa-circle" style="color: var(--success-color);"></i>
                    <span id="statusMessage">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-file-code"></i>
                    <span id="lineCount">Ø§Ù„Ø£Ø³Ø·Ø±: 0</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-keyboard"></i>
                    <span id="charCount">Ø§Ù„Ø£Ø­Ø±Ù: 0</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-globe"></i>
                    <span id="currentLanguage">HTML</span>
                </div>
            </div>
            <div class="status-right">
                <div class="status-item">
                    <i class="fas fa-clock"></i>
                    <span id="lastUpdate">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ø¢Ù†</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-memory"></i>
                    <span id="memoryUsage">Ø§Ù„Ø°Ø§ÙƒØ±Ø©: 0 MB</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Command Palette -->
    <div class="command-palette" id="commandPalette">
        <input type="text" class="command-input" id="commandInput" placeholder="Ø§ÙƒØªØ¨ Ø£Ù…Ø±Ø§Ù‹...">
        <div class="command-list" id="commandList">
            <div class="command-item" data-command="save">
                <span>Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù</span>
                <span class="command-key">Ctrl+S</span>
            </div>
            <div class="command-item" data-command="format">
                <span>ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯</span>
                <span class="command-key">Shift+Alt+F</span>
            </div>
            <div class="command-item" data-command="run">
                <span>ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯</span>
                <span class="command-key">F5</span>
            </div>
            <div class="command-item" data-command="toggle-theme">
                <span>ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©</span>
                <span class="command-key">Ctrl+Shift+L</span>
            </div>
            <div class="command-item" data-command="new-file">
                <span>Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯</span>
                <span class="command-key">Ctrl+N</span>
            </div>
            <div class="command-item" data-command="open-file">
                <span>ÙØªØ­ Ù…Ù„Ù</span>
                <span class="command-key">Ctrl+O</span>
            </div>
        </div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-content">
            <div class="settings-header">
                <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ProCode Studio</h2>
                <button class="btn btn-secondary" onclick="hideSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="settings-body">
                <div class="setting-group">
                    <h3><i class="fas fa-palette"></i> Ø§Ù„Ù…Ø¸Ù‡Ø±</h3>
                    <div class="setting-item">
                        <span class="setting-label">Ø§Ù„Ø³Ù…Ø©</span>
                        <div class="setting-control">
                            <button class="btn btn-secondary" onclick="toggleTheme()">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©</button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Ø­Ø¬Ù… Ø§Ù„Ø®Ø·</span>
                        <div class="setting-control">
                            <button class="btn btn-secondary" onclick="changeFontSize(-1)">-</button>
                            <span id="fontSizeDisplay">13px</span>
                            <button class="btn btn-secondary" onclick="changeFontSize(1)">+</button>
                        </div>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3><i class="fas fa-code"></i> Ø§Ù„Ù…Ø­Ø±Ø±</h3>
                    <div class="setting-item">
                        <span class="setting-label">Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…Ø±Ù‚Ù…Ø©</span>
                        <div class="setting-control">
                            <input type="checkbox" id="lineNumbers" checked onchange="toggleLineNumbers()">
                        </div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Ø¥ÙƒÙ…Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                        <div class="setting-control">
                            <input type="checkbox" id="autoComplete" checked onchange="toggleAutoComplete()">
                        </div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ù‚ÙˆØ§Ø³</span>
                        <div class="setting-control">
                            <input type="checkbox" id="bracketMatching" checked onchange="toggleBracketMatching()">
                        </div>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3><i class="fas fa-cogs"></i> Ø¹Ø§Ù…</h3>
                    <div class="setting-item">
                        <span class="setting-label">Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                        <div class="setting-control">
                            <input type="checkbox" id="autoSave" checked onchange="toggleAutoSave()">
                        </div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</span>
                        <div class="setting-control">
                            <input type="checkbox" id="livePreview" checked onchange="toggleLivePreview()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let editor;
        let currentLanguage = 'html';
        let isLightTheme = false;
        let openTabs = [];
        let currentFile = 'welcome.html';
        let autoSave = true;
        let livePreview = true;
        
        // Ø¯Ø¹Ù… Ø§Ù„Ù„ØºØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        const languageSupport = {
            'html': { name: 'HTML', extension: 'html', mode: 'html' },
            'css': { name: 'CSS', extension: 'css', mode: 'css' },
            'javascript': { name: 'JavaScript', extension: 'js', mode: 'javascript' },
            'typescript': { name: 'TypeScript', extension: 'ts', mode: 'javascript' },
            'python': { name: 'Python', extension: 'py', mode: 'python' },
            'php': { name: 'PHP', extension: 'php', mode: 'php' },
            'java': { name: 'Java', extension: 'java', mode: 'clike' },
            'c': { name: 'C', extension: 'c', mode: 'clike' },
            'cpp': { name: 'C++', extension: 'cpp', mode: 'clike' },
            'csharp': { name: 'C#', extension: 'cs', mode: 'clike' },
            'go': { name: 'Go', extension: 'go', mode: 'go' },
            'rust': { name: 'Rust', extension: 'rs', mode: 'rust' },
            'swift': { name: 'Swift', extension: 'swift', mode: 'swift' },
            'kotlin': { name: 'Kotlin', extension: 'kt', mode: 'clike' },
            'ruby': { name: 'Ruby', extension: 'rb', mode: 'ruby' },
            'sql': { name: 'SQL', extension: 'sql', mode: 'sql' },
            'json': { name: 'JSON', extension: 'json', mode: 'javascript' },
            'yaml': { name: 'YAML', extension: 'yml', mode: 'yaml' },
            'xml': { name: 'XML', extension: 'xml', mode: 'xml' },
            'markdown': { name: 'Markdown', extension: 'md', mode: 'markdown' },
            'apk': { name: 'APK Analysis', extension: 'txt', mode: 'text' }
        };

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        const corsProxies = [
            {
                name: 'AllOrigins',
                url: (target) => `https://api.allorigins.win/get?url=${encodeURIComponent(target)}`,
                parser: (data) => data.contents
            },
            {
                name: 'CORS Proxy',
                url: (target) => `https://corsproxy.io/?${encodeURIComponent(target)}`,
                parser: (data) => data
            },
            {
                name: 'Proxy Server',
                url: (target) => `https://api.codetabs.com/v1/proxy?quest=${target}`,
                parser: (data) => data
            }
        ];

        // Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ± Matrix Ù…Ø­Ø³Ù†
        function createMatrixEffect() {
            const container = document.getElementById('matrixContainer');
            const columns = Math.floor(window.innerWidth / 18);
            
            for (let i = 0; i < columns; i++) {
                const column = document.createElement('div');
                column.className = 'matrix-column';
                column.style.left = `${i * 18}px`;
                
                const digitCount = Math.floor(Math.random() * 8) + 4;
                for (let j = 0; j < digitCount; j++) {
                    const digit = document.createElement('div');
                    digit.className = 'matrix-digit';
                    digit.textContent = Math.random() > 0.3 ? '1' : '0';
                    digit.style.top = `${j * 18}px`;
                    digit.style.animationDelay = `${Math.random() * 1.5}s`;
                    column.appendChild(digit);
                }
                
                container.appendChild(column);
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        function initEditor() {
            const { EditorView, keymap, ViewUpdate } = window.CodeMirror;
            const { defaultKeymap, history, historyKeymap } = window.CodeMirror;
            
            editor = new EditorView({
                doc: getSampleCode(),
                extensions: [
                    keymap.of([
                        ...defaultKeymap,
                        ...historyKeymap,
                        { key: "Ctrl-s", run: () => saveFile() },
                        { key: "F5", run: () => runCode() },
                        { key: "Ctrl-f", run: () => showSearch() },
                        { key: "Ctrl-Shift-f", run: () => showSearch() },
                        { key: "Ctrl-Shift-p", run: () => showCommandPalette() },
                        { key: "Ctrl-Shift-l", run: () => toggleTheme() },
                        { key: "Ctrl-,", run: () => showSettings() },
                        { key: "Ctrl-n", run: () => newFile() },
                        { key: "Ctrl-o", run: () => openFile() }
                    ]),
                    history(),
                    EditorView.updateListener.of((update) => {
                        if (update.docChanged) {
                            updateStatus();
                            if (autoSave) {
                                localStorage.setItem('procode_content', editor.state.doc.toString());
                            }
                            if (livePreview) {
                                updatePreview();
                            }
                        }
                    }),
                    EditorView.theme({
                        "&": {
                            color: "var(--text-primary)",
                            backgroundColor: "var(--editor-bg)"
                        },
                        ".cm-content": {
                            padding: "16px",
                            fontFamily: "'JetBrains Mono', monospace",
                            fontSize: "13px",
                            lineHeight: "1.5"
                        },
                        "&.cm-focused .cm-cursor": {
                            borderLeftColor: "var(--accent-color)"
                        },
                        "&.cm-focused .cm-selectionBackground, ::selection": {
                            backgroundColor: "var(--selection-color)"
                        },
                        ".cm-gutters": {
                            backgroundColor: "var(--secondary-bg)",
                            color: "var(--text-secondary)",
                            border: "none"
                        },
                        ".cm-activeLineGutter": {
                            backgroundColor: "var(--active-line-bg)"
                        },
                        ".cm-activeLine": {
                            backgroundColor: "var(--active-line-bg)"
                        }
                    })
                ],
                parent: document.getElementById('editor')
            });
            
            // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­ÙÙˆØ¸
            const savedContent = localStorage.getItem('procode_content');
            if (savedContent) {
                editor.dispatch({
                    changes: { from: 0, to: editor.state.doc.length, insert: savedContent }
                });
            }
            
            updateStatus();
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠ
        function getSampleCode() {
            return `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProCode Studio - Ø¨ÙŠØ¦Ø© ØªØ·ÙˆÙŠØ± Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', 'Inter', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }
        
        .container {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 90%;
            position: relative;
            z-index: 10;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.3rem;
            margin-bottom: 30px;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .feature:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .feature h3 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .feature p {
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.6);
            background: linear-gradient(45deg, #ff5252, #d32f2f);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .container > * {
            animation: fadeInUp 0.8s ease forwards;
        }
        
        .container > *:nth-child(2) { animation-delay: 0.1s; }
        .container > *:nth-child(3) { animation-delay: 0.2s; }
        .container > *:nth-child(4) { animation-delay: 0.3s; }
        .container > *:nth-child(5) { animation-delay: 0.4s; }
        
        .code-highlight {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ProCode Studio</h1>
        <p class="subtitle">Ø¨ÙŠØ¦Ø© ØªØ·ÙˆÙŠØ± Ù…ØªÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ø¯Ø¹Ù… <span class="code-highlight">20+ Ù„ØºØ© Ø¨Ø±Ù…Ø¬Ø©</span></p>
        
        <div class="features">
            <div class="feature">
                <h3>ğŸŒ Ø¯Ø¹Ù… Ù„ØºØ§Øª Ù…ØªØ¹Ø¯Ø¯</h3>
                <p>JavaScript, TypeScript, Python, PHP, Go, Rust, C++, Java, Swift, Kotlin ÙˆØ§Ù„Ù…Ø²ÙŠØ¯</p>
            </div>
            <div class="feature">
                <h3>ğŸ§  Ù…Ø­Ø±Ø± Ø°ÙƒÙŠ</h3>
                <p>Ø¥ÙƒÙ…Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ØªÙ‚Ø¯Ù…ØŒ ØªÙ†Ø³ÙŠÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ ÙˆØªØµØ­ÙŠØ­ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</p>
            </div>
            <div class="feature">
                <h3>ğŸ¨ ØªØ®ØµÙŠØµ ÙƒØ§Ù…Ù„</h3>
                <p>Ø«ÙŠÙ…Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©ØŒ Ø®Ø·ÙˆØ· Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµØŒ ÙˆØªØ®Ø·ÙŠØ· Ù…Ø±Ù†</p>
            </div>
            <div class="feature">
                <h3>âš¡ Ø£Ø¯Ø§Ø¡ ÙØ§Ø¦Ù‚</h3>
                <p>ØªØ­Ù…ÙŠÙ„ Ø³Ø±ÙŠØ¹ØŒ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙˆØ±ÙŠØ©ØŒ ÙˆØªØ­Ø±ÙŠØ± Ø³Ù„Ø³ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙƒØ¨ÙŠØ±Ø©</p>
            </div>
            <div class="feature">
                <h3>ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
                <p>Command PaletteØŒ Ø¨Ø­Ø« Ø´Ø§Ù…Ù„ØŒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Ù…ØªØ·ÙˆØ±Ø©</p>
            </div>
            <div class="feature">
                <h3>ğŸ“± ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨</h3>
                <p>ÙŠØ¹Ù…Ù„ Ø¨Ø³Ù„Ø§Ø³Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙ Ø¥Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨</p>
            </div>
        </div>
        
        <button class="btn" onclick="showDemo()">âœ¨ Ø§ÙƒØªØ´Ù Ø§Ù„Ù…ÙŠØ²Ø§Øª</button>
    </div>
    
    <script>
        function showDemo() {
            alert('ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ProCode Studio!\\n\\nâœ¨ Ù…ÙŠØ²Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©:\\nâ€¢ Ù…Ø­Ø±Ø± Ø°ÙƒÙŠ Ù…Ø¹ Ø¥ÙƒÙ…Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ\\nâ€¢ Ø¯Ø¹Ù… 20+ Ù„ØºØ© Ø¨Ø±Ù…Ø¬Ø©\\nâ€¢ ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ ÙˆØ£Ù†ÙŠÙ‚\\nâ€¢ Ø£Ø¯ÙˆØ§Øª ØªØ·ÙˆÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠØ©\\n\\nğŸš€ Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ ÙÙŠ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø¢Ù†!');
            
            // ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ©
            document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            console.log('ğŸš€ ProCode Studio loaded successfully!');
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„Ù…Ù…ÙŠØ²Ø§Øª
            document.querySelectorAll('.feature').forEach((feature, index) => {
                setTimeout(() => {
                    feature.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-8px) scale(1.02)';
                        this.style.transition = 'all 0.3s ease';
                    });
                    
                    feature.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0) scale(1)';
                    });
                }, index * 100);
            });
        }
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ProCode Studio initialized');
            
            // ØªØ£Ø«ÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„Ø¹Ù†ÙˆØ§Ù†
            const title = document.querySelector('h1');
            const text = title.textContent;
            title.textContent = '';
            
            let i = 0;
            function typeWriter() {
                if (i < text.length) {
                    title.textContent += text.charAt(i);
                    i++;
                    setTimeout(typeWriter, 100);
                }
            }
            
            setTimeout(typeWriter, 1000);
        });
    </script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>
</body>
</html>`;
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©
        function toggleTheme() {
            isLightTheme = !isLightTheme;
            document.body.classList.toggle('light-theme', isLightTheme);
            
            if (editor) {
                const theme = isLightTheme ? 'light' : 'dark';
                editor.dispatch({
                    effects: window.CodeMirror.EditorView.theme({
                        "&": {
                            color: isLightTheme ? "#212529" : "#cccccc",
                            backgroundColor: isLightTheme ? "#ffffff" : "#1e1e1e"
                        }
                    })
                });
            }
            
            showNotification(`ØªÙ… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø© Ø¥Ù„Ù‰ ${isLightTheme ? 'Ø§Ù„ÙØ§ØªØ­Ø©' : 'Ø§Ù„Ø¯Ø§ÙƒÙ†Ø©'}`, 'success');
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        function switchSidebarTab(tab) {
            const tabs = document.querySelectorAll('.sidebar-tab');
            const panels = document.querySelectorAll('.sidebar-content > div');
            
            tabs.forEach(t => t.classList.remove('active'));
            panels.forEach(p => p.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Panel').style.display = 'block';
        }

        // Ø¹Ø±Ø¶ Command Palette
        function showCommandPalette() {
            const palette = document.getElementById('commandPalette');
            const input = document.getElementById('commandInput');
            
            palette.classList.add('show');
            input.focus();
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡
            setTimeout(() => {
                document.addEventListener('click', hideCommandPalette);
            }, 100);
        }

        function hideCommandPalette() {
            const palette = document.getElementById('commandPalette');
            palette.classList.remove('show');
            document.removeEventListener('click', hideCommandPalette);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function showSettings() {
            const settings = document.getElementById('settingsPanel');
            settings.classList.add('show');
        }

        function hideSettings() {
            const settings = document.getElementById('settingsPanel');
            settings.classList.remove('show');
        }

        // ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
        function changeFontSize(delta) {
            const display = document.getElementById('fontSizeDisplay');
            const currentSize = parseInt(display.textContent);
            const newSize = Math.max(10, Math.min(24, currentSize + delta));
            
            display.textContent = newSize + 'px';
            
            if (editor) {
                editor.dispatch({
                    effects: window.CodeMirror.EditorView.theme({
                        ".cm-content": {
                            fontSize: newSize + "px"
                        }
                    })
                });
            }
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function toggleLineNumbers() {
            const checkbox = document.getElementById('lineNumbers');
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø±Ø±
        }

        function toggleAutoComplete() {
            const checkbox = document.getElementById('autoComplete');
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø±Ø±
        }

        function toggleBracketMatching() {
            const checkbox = document.getElementById('bracketMatching');
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø±Ø±
        }

        function toggleAutoSave() {
            const checkbox = document.getElementById('autoSave');
            autoSave = checkbox.checked;
            showNotification(`Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ${autoSave ? 'Ù…ÙØ¹Ù„' : 'Ù…Ø¹Ø·Ù„'}`, 'success');
        }

        function toggleLivePreview() {
            const checkbox = document.getElementById('livePreview');
            livePreview = checkbox.checked;
            showNotification(`Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© ${livePreview ? 'Ù…ÙØ¹Ù„Ø©' : 'Ù…Ø¹Ø·Ù„Ø©'}`, 'success');
        }

        // Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        async function fetchCode() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­', 'error');
                return;
            }

            updateProgress(10);
            showNotification('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯...', 'info');

            try {
                let content = null;
                let lastError = null;

                for (let i = 0; i < corsProxies.length; i++) {
                    const proxy = corsProxies[i];
                    try {
                        updateProgress(20 + (i * 20));
                        
                        const proxyUrl = proxy.url(url);
                        const response = await fetch(proxyUrl);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }

                        const data = await response.json();
                        content = proxy.parser(data);
                        
                        if (content && content.length > 0) {
                            updateProgress(90);
                            break;
                        }
                    } catch (error) {
                        lastError = error;
                        continue;
                    }
                }

                if (!content) {
                    throw new Error(`ÙØ´Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª. Ø¢Ø®Ø± Ø®Ø·Ø£: ${lastError?.message}`);
                }

                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
                const extension = getFileExtension(url);
                const language = getLanguageFromExtension(extension);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø±Ø±
                if (editor) {
                    editor.dispatch({
                        changes: { from: 0, to: editor.state.doc.length, insert: content }
                    });
                }
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯
                const filename = url.split('/').pop() || 'fetched-file';
                addTab(filename, extension);
                
                updateProgress(100);
                showNotification('ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
                setTimeout(() => updateProgress(0), 500);
                
            } catch (error) {
                updateProgress(0);
                showNotification(`ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯: ${error.message}`, 'error');
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    const extension = getFileExtension(file.name);
                    const language = getLanguageFromExtension(extension);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø±Ø±
                    if (editor) {
                        editor.dispatch({
                            changes: { from: 0, to: editor.state.doc.length, insert: content }
                        });
                    }
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯
                    addTab(file.name, extension);
                    
                    showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${file.name}`, 'success');
                };
                
                reader.readAsText(file);
            });
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯
        function addTab(filename, extension) {
            const tabsContainer = document.getElementById('editorTabs');
            const existingTab = Array.from(tabsContainer.children).find(tab => 
                tab.dataset.file === filename
            );
            
            if (existingTab) {
                // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
                activateTab(existingTab);
                return;
            }
            
            const tab = document.createElement('div');
            tab.className = 'editor-tab';
            tab.dataset.file = filename;
            tab.dataset.extension = extension;
            
            tab.innerHTML = `
                <i class="fas fa-file-code"></i>
                ${filename}
                <span class="tab-close" onclick="closeTab(this)">Ã—</span>
            `;
            
            tab.onclick = () => activateTab(tab);
            tabsContainer.appendChild(tab);
            activateTab(tab);
        }

        // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        function activateTab(tab) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.editor-tab').forEach(t => {
                t.classList.remove('active');
            });
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            tab.classList.add('active');
            currentFile = tab.dataset.file;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ØºØ©
            const extension = tab.dataset.extension;
            const language = getLanguageFromExtension(extension);
            setLanguage(language);
            
            showNotification(`ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ ${currentFile}`, 'info');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        function closeTab(closeBtn) {
            event.stopPropagation();
            const tab = closeBtn.closest('.editor-tab');
            const tabs = document.querySelectorAll('.editor-tab');
            
            if (tabs.length <= 1) {
                showNotification('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥ØºÙ„Ø§Ù‚ Ø¢Ø®Ø± ØªØ¨ÙˆÙŠØ¨', 'warning');
                return;
            }
            
            tab.remove();
            
            // ØªÙØ¹ÙŠÙ„ Ø£ÙˆÙ„ ØªØ¨ÙˆÙŠØ¨ Ù…ØªØ¨Ù‚ÙŠ
            const firstTab = document.querySelector('.editor-tab');
            if (firstTab) {
                activateTab(firstTab);
            }
        }

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ØºØ©
        function setLanguage(language) {
            currentLanguage = language;
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø©
            const languageNames = {
                'html': 'HTML',
                'css': 'CSS',
                'javascript': 'JavaScript',
                'typescript': 'TypeScript',
                'python': 'Python',
                'php': 'PHP',
                'java': 'Java',
                'c': 'C',
                'cpp': 'C++',
                'csharp': 'C#',
                'go': 'Go',
                'rust': 'Rust',
                'swift': 'Swift',
                'kotlin': 'Kotlin',
                'ruby': 'Ruby',
                'sql': 'SQL',
                'json': 'JSON',
                'yaml': 'YAML',
                'xml': 'XML',
                'markdown': 'Markdown'
            };
            
            document.getElementById('currentLanguage').textContent = 
                languageNames[language] || language.toUpperCase();
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù„ØºØ© Ù…Ù† Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ù…Ù„Ù
        function getLanguageFromExtension(extension) {
            for (const [lang, config] of Object.entries(languageSupport)) {
                if (config.extension === extension) {
                    return lang;
                }
            }
            return 'text';
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ù…Ù„Ù
        function getFileExtension(filename) {
            return filename.split('.').pop().toLowerCase();
        }

        // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
        function saveFile() {
            if (!editor) return;
            
            const content = editor.state.doc.toString();
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentFile || 'code.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`ØªÙ… Ø­ÙØ¸ ${currentFile}`, 'success');
        }

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯
        function formatCode() {
            if (!editor) return;
            
            // ØªØ·Ø¨ÙŠÙ‚ ØªÙ†Ø³ÙŠÙ‚ Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„ÙƒÙˆØ¯
            let content = editor.state.doc.toString();
            
            try {
                // ØªÙ†Ø³ÙŠÙ‚ HTML
                if (currentLanguage === 'html') {
                    content = formatHTML(content);
                }
                // ØªÙ†Ø³ÙŠÙ‚ CSS
                else if (currentLanguage === 'css') {
                    content = formatCSS(content);
                }
                // ØªÙ†Ø³ÙŠÙ‚ JavaScript
                else if (currentLanguage === 'javascript') {
                    content = formatJavaScript(content);
                }
                
                editor.dispatch({
                    changes: { from: 0, to: editor.state.doc.length, insert: content }
                });
                
                showNotification('ØªÙ… ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                showNotification('ÙØ´Ù„ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯', 'error');
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        function runCode() {
            if (!editor) return;
            
            const content = editor.state.doc.toString();
            
            // ØªØ´ØºÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            updatePreview();
            
            showNotification('ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯', 'success');
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function updatePreview() {
            if (!editor) return;
            
            const iframe = document.getElementById('previewFrame');
            const content = editor.state.doc.toString();
            
            iframe.srcdoc = content;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹
        function refreshPreview() {
            updatePreview();
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©', 'success');
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø©
        function updateStatus() {
            if (!editor) return;
            
            const content = editor.state.doc.toString();
            const lines = content.split('\n').length;
            const chars = content.length;
            
            document.getElementById('lineCount').textContent = `Ø§Ù„Ø£Ø³Ø·Ø±: ${lines.toLocaleString()}`;
            document.getElementById('charCount').textContent = `Ø§Ù„Ø£Ø­Ø±Ù: ${chars.toLocaleString()}`;
            document.getElementById('lastUpdate').textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleTimeString('ar-SA')}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            const memoryUsage = Math.round((chars * 2) / 1024);
            document.getElementById('memoryUsage').textContent = `Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${memoryUsage} KB`;
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'warning': 'fas fa-exclamation-triangle',
                'info': 'fas fa-info-circle'
            };
            
            notification.innerHTML = `
                <i class="${icons[type]}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgress(percentage) {
            const container = document.getElementById('progressContainer');
            const bar = document.getElementById('progressBar');
            
            if (percentage > 0) {
                container.classList.add('show');
                bar.style.width = `${percentage}%`;
            } else {
                container.classList.remove('show');
                bar.style.width = '0%';
            }
        }

        // Ø§Ù„Ø¨Ø­Ø«
        function showSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.focus();
        }

        // Ù…Ù„ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©
        function newFile() {
            const filename = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯:');
            if (filename) {
                addTab(filename, getFileExtension(filename));
                showNotification(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${filename}`, 'success');
            }
        }

        // ÙØªØ­ Ù…Ù„Ù
        function openFile() {
            document.getElementById('fileInput').click();
        }

        // Ù…Ø¹Ø§Ù„Ø¬ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveFile();
                        break;
                    case 'f':
                        e.preventDefault();
                        showSearch();
                        break;
                    case 'p':
                        if (e.shiftKey) {
                            e.preventDefault();
                            showCommandPalette();
                        }
                        break;
                    case 'l':
                        if (e.shiftKey) {
                            e.preventDefault();
                            toggleTheme();
                        }
                        break;
                    case ',':
                        e.preventDefault();
                        showSettings();
                        break;
                    case 'n':
                        e.preventDefault();
                        newFile();
                        break;
                    case 'o':
                        e.preventDefault();
                        openFile();
                        break;
                }
            }
            
            if (e.key === 'F5') {
                e.preventDefault();
                runCode();
            }
            
            if (e.key === 'Escape') {
                hideCommandPalette();
                hideSettings();
            }
        });

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            createMatrixEffect();
            initEditor();
            
            // Ù…Ø­ØªÙˆÙ‰ ØªØ¬Ø±ÙŠØ¨ÙŠ
            const savedContent = localStorage.getItem('procode_content');
            if (savedContent) {
                editor.dispatch({
                    changes: { from: 0, to: editor.state.doc.length, insert: savedContent }
                });
            }
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
            setTimeout(() => {
                showNotification('ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ProCode Studio!', 'success');
            }, 2000);
        });
    </script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>
</body>
</html>